var cmi=cmi||{};cmi.config={JSON_FILE:"static/data/cmi-sample.json"};var cmi=cmi||{};cmi.main={cache:{},total:0,USE_BEFORE_RATE:!0,USE_AFTER_RATE:!1,init:function(){$.getJSON(cmi.config.JSON_FILE,function(a){cmi.DATA=a,cmi.main.process_data()}),this.cache={total:$("#total")},$("#rental-equipment").on("change",function(a){cmi.main.update_row_total(a.target),cmi.main.update_order_total(a.target)})},process_data:function(){cmi.utils.render_template({target:"#event-information",template:"#event-information-tpl",context:cmi.DATA.event_information}),cmi.utils.render_template({target:"#rental-equipment-headers",template:"#rental-equipment-headers-tpl",context:cmi.DATA.event_information}),cmi.utils.render_template({target:"#rental-equipment-table",template:"#rental-equipment-tpl",context:{rental_equipment:cmi.DATA.rental_equipment},append:!0});var a=moment(),b=moment(cmi.DATA.event_information.after_rate_deadline);moment(a).isAfter(b)&&(this.USE_BEFORE_RATE=!1,this.USE_AFTER_RATE=!0)},update_row_total:function(a){var b=parseInt(a.value,10),c=0,d=0;isNaN(b)?(alert("Enter a number, please"),a.value="",d=0):(this.USE_BEFORE_RATE?c=parseInt(a.parentNode.parentNode.getAttribute("data-before-rate"),10):this.USE_AFTER_RATE&&(c=parseInt(a.parentNode.parentNode.getAttribute("data-after-rate"),10)),d=c*b),$(a.parentNode.parentNode).find(".total").html(d)},update_order_total:function(){var a=0;$(".total").each(function(b,c){var d=parseInt(c.innerHTML,10);isNaN(d)||(a+=d)}),$("#total").html(a)}},window.onload=cmi.main.init;var cmi=cmi||{};cmi.utils={render_template:function(a){if(!a.template||""===a.template)return void $(a.target).html("");var b=Handlebars.compile($(a.template).html()),c=b(a.context?a.context:{});a.append?$(a.target).append(c):a.prepend?$(a.target).prepend(c):$(a.target).html(c)},load_localStorage:function(a){return JSON.parse(localStorage.getItem(a))},save_localStorage:function(a,b){localStorage.setItem(a,JSON.stringify(b)),console.log("data saved: "+a)},clear_localStorage:function(a){localStorage.removeItem(a),console.log("data removed: "+a)}};
